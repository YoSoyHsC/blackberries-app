{% extends 'base.html' %}
{% block content %}
<h3 class="mb-3">Catálogos (Admin)</h3>
<div class="alert alert-info">Agrega, activa/inactiva o elimina elementos. También administra la <b>lista de precios</b> por <i>fruto + tamaño</i>.</div>
<div class="row g-4">
  <div class="col-lg-6">
    <div class="card"><div class="card-body">
      <h5 class="card-title">Frutos</h5>
      <form method="post" class="row g-2 mb-3">
        <input type="hidden" name="action" value="add_fruit">
        <div class="col-8"><input class="form-control" name="fruit_name" placeholder="Nombre del fruto" required></div>
        <div class="col-4 d-grid"><button class="btn btn-primary">Agregar</button></div>
      </form>
      <div class="table-responsive"><table class="table table-sm align-middle">
        <thead><tr><th>Nombre</th><th>Activo</th><th class="text-end">Acciones</th></tr></thead>
        <tbody>
          {% for f in fruits %}
          <tr>
            <td>{{ f.name }}</td>
            <td>{{ 'Sí' if f.active else 'No' }}</td>
            <td class="text-end">
              <form method="post" class="d-inline">
                <input type="hidden" name="action" value="toggle_fruit">
                <input type="hidden" name="fruit_id" value="{{ f.id }}">
                <button class="btn btn-sm btn-outline-secondary">Activar/Desactivar</button>
              </form>
              <form method="post" class="d-inline" onsubmit="return confirm('¿Eliminar fruto?');">
                <input type="hidden" name="action" value="delete_fruit">
                <input type="hidden" name="fruit_id" value="{{ f.id }}">
                <button class="btn btn-sm btn-outline-danger">Eliminar</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table></div>
    </div></div>
  </div>
  <div class="col-lg-6">
    <div class="card"><div class="card-body">
      <h5 class="card-title">Sectores</h5>
      <form method="post" class="row g-2 mb-3">
        <input type="hidden" name="action" value="add_sector">
        <div class="col-4"><input class="form-control" name="sector_code" placeholder="Código (ej. S1)" required></div>
        <div class="col-6"><input class="form-control" name="sector_desc" placeholder="Descripción (opcional)"></div>
        <div class="col-2 d-grid"><button class="btn btn-primary">Agregar</button></div>
      </form>
      <div class="table-responsive"><table class="table table-sm align-middle">
        <thead><tr><th>Código</th><th>Descripción</th><th>Activo</th><th class="text-end">Acciones</th></tr></thead>
        <tbody>
          {% for s in sectors %}
          <tr>
            <td>{{ s.code }}</td><td>{{ s.description or '' }}</td>
            <td>{{ 'Sí' if s.active else 'No' }}</td>
            <td class="text-end">
              <form method="post" class="d-inline">
                <input type="hidden" name="action" value="toggle_sector">
                <input type="hidden" name="sector_id" value="{{ s.id }}">
                <button class="btn btn-sm btn-outline-secondary">Activar/Desactivar</button>
              </form>
              <form method="post" class="d-inline" onsubmit="return confirm('¿Eliminar sector?');">
                <input type="hidden" name="action" value="delete_sector">
                <input type="hidden" name="sector_id" value="{{ s.id }}">
                <button class="btn btn-sm btn-outline-danger">Eliminar</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table></div>
    </div></div>
  </div>
  <div class="col-lg-6">
    <div class="card"><div class="card-body">
      <h5 class="card-title">Cortadoras</h5>
      <form method="post" class="row g-2 mb-3">
        <input type="hidden" name="action" value="add_picker">
        <div class="col-3"><input class="form-control" name="picker_code" placeholder="ID (ej. C006)" required></div>
        <div class="col-7"><input class="form-control" name="picker_name" placeholder="Nombre" required></div>
        <div class="col-2 d-grid"><button class="btn btn-primary">Agregar</button></div>
      </form>
      <div class="table-responsive"><table class="table table-sm align-middle">
        <thead><tr><th>ID</th><th>Nombre</th><th>Activo</th><th class="text-end">Acciones</th></tr></thead>
        <tbody>
          {% for p in pickers %}
          <tr>
            <td>{{ p.code }}</td><td>{{ p.name }}</td>
            <td>{{ 'Sí' if p.active else 'No' }}</td>
            <td class="text-end">
              <form method="post" class="d-inline">
                <input type="hidden" name="action" value="toggle_picker">
                <input type="hidden" name="picker_id" value="{{ p.id }}">
                <button class="btn btn-sm btn-outline-secondary">Activar/Desactivar</button>
              </form>
              <form method="post" class="d-inline" onsubmit="return confirm('¿Eliminar cortadora?');">
                <input type="hidden" name="action" value="delete_picker">
                <input type="hidden" name="picker_id" value="{{ p.id }}">
                <button class="btn btn-sm btn-outline-danger">Eliminar</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table></div>
    </div></div>
  </div>
  <div class="col-lg-6">
    <div class="card"><div class="card-body">
      <h5 class="card-title">Tamaños de caja</h5>
      <form method="post" class="row g-2 mb-3">
        <input type="hidden" name="action" value="add_size">
        <div class="col-8"><input class="form-control" name="size_name" placeholder="Ej. 4oz" required></div>
        <div class="col-4 d-grid"><button class="btn btn-primary">Agregar</button></div>
      </form>
      <div class="table-responsive"><table class="table table-sm align-middle">
        <thead><tr><th>Nombre</th><th>Activo</th><th class="text-end">Acciones</th></tr></thead>
        <tbody>
          {% for z in sizes %}
          <tr>
            <td>{{ z.name }}</td>
            <td>{{ 'Sí' if z.active else 'No' }}</td>
            <td class="text-end">
              <form method="post" class="d-inline">
                <input type="hidden" name="action" value="toggle_size">
                <input type="hidden" name="size_id" value="{{ z.id }}">
                <button class="btn btn-sm btn-outline-secondary">Activar/Desactivar</button>
              </form>
              <form method="post" class="d-inline" onsubmit="return confirm('¿Eliminar tamaño?');">
                <input type="hidden" name="action" value="delete_size">
                <input type="hidden" name="size_id" value="{{ z.id }}">
                <button class="btn btn-sm btn-outline-danger">Eliminar</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table></div>
    </div></div>
  </div>
  <div class="col-12">
    <div class="card"><div class="card-body">
      <h5 class="card-title">Lista de precios por Fruto + Tamaño</h5>
      <form method="post" class="row g-2 mb-3">
        <input type="hidden" name="action" value="set_price">
        <div class="col-md-3">
          <select class="form-select" name="fruit_id" required>
            <option value="">Fruto</option>
            {% for f in fruits %}<option value="{{ f.id }}">{{ f.name }}</option>{% endfor %}
          </select>
        </div>
        <div class="col-md-3">
          <select class="form-select" name="size_id" required>
            <option value="">Tamaño</option>
            {% for z in sizes %}<option value="{{ z.id }}">{{ z.name }}</option>{% endfor %}
          </select>
        </div>
        <div class="col-md-3"><input type="number" step="0.01" min="0" class="form-control" name="price" placeholder="Precio" required></div>
        <div class="col-md-3 d-grid"><button class="btn btn-success">Guardar precio</button></div>
      </form>
      <div class="table-responsive"><table class="table table-sm align-middle">
        <thead><tr><th>ID</th><th>Fruto</th><th>Tamaño</th><th class="text-end">Precio</th><th class="text-end">Acciones</th></tr></thead>
        <tbody>
          {% for p in prices %}
          <tr>
            <td>{{ p.id }}</td><td>{{ p.fruit.name }}</td><td>{{ p.size.name }}</td>
            <td class="text-end">${{ '%.2f'|format(p.price) }}</td>
            <td class="text-end">
              <form method="post" class="d-inline" onsubmit="return confirm('¿Eliminar precio?');">
                <input type="hidden" name="action" value="delete_price">
                <input type="hidden" name="price_id" value="{{ p.id }}">
                <button class="btn btn-sm btn-outline-danger">Eliminar</button>
              </form>
            </td>
          </tr>
          {% endfor %}
          {% if not prices %}
          <tr><td colspan="5" class="text-center text-muted">Sin precios. Agrega arriba.</td></tr>
          {% endif %}
        </tbody>
      </table></div>
    </div></div>
  </div>
</div>
{% endblock %}
